<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
        rel="stylesheet"
        as="style"
        onload="this.rel='stylesheet'"
        href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Space+Grotesk%3Awght%40400%3B500%3B700"
    />
    <title>DeFi AI Chat</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>body {

        background-color: #32474f;
        
        font-family: 'Space Grotesk', sans-serif;
        
        color: white;
        
        position: relative;
        
        }
        
        
        
        body::before {
        
        content: "";
        
        position: absolute;
        
        top: 0;
        
        left: 0;
        
        width: 100%;
        
        height: 100%;
        
        background-image: url('/images/web3-bg.jpg');
        
        background-size: cover;
        
        background-repeat: no-repeat;
        
        filter: blur(30px);
        
        z-index: -1;
        
        }
        
        
        
        #sidebar {
        
        transition: transform 0.3s ease-in-out;
        
        transform: translateX(-100%);
        
        }
        
        
        
        #sidebar.open {
        
        transform: translateX(0);
        
        }
        
        
        
        .chat-bubble {
        
        width: fit-content; /* Adjust width to fit content */
        
        max-width: 90%; /* Prevent bubbles from being too wide */
        
        padding: 15px 20px;
        
        border-radius: 25px;
        
        margin-bottom: 15px;
        
        word-wrap: break-word;
        
        display: flex;
        
        align-items: flex-start;
        
        }
        
        
        
        .chat-bubble.user {
        
        background-color: #355a6e;
        
        align-self: flex-end;
        
        }
        
        
        
        .chat-bubble.bot {
        
        background-color: #676f74;
        
        align-self: flex-start; /* Corrected to flex-start */
        
        }
        
        
        
        .chat-bubble i {
        
        width: 30px;
        
        height: 30px;
        
        border-radius: 50%;
        
        display: flex;
        
        align-items: center;
        
        justify-content: center;
        
        margin-right: 10px;
        
        background: linear-gradient(135deg, #8a2be2, #00bfff);
        
        box-shadow: 0 0 10px rgba(138, 43, 226, 0.7);
        
        color: white;
        
        }
    </style>
</head>
<body class="bg-[#111618] text-white font-['Space_Grotesk',_sans-serif] flex">
    <div class="flex flex-col flex-1 min-h-screen">
        <div class="flex items-center justify-between p-4">
            <button id="sidebar-toggle" class="bg-transparent border-none p-0">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <h1 class="text-2xl font-bold">DeFi AI</h1>
            <button class="bg-transparent border-none p-0">
                <i class="fas fa-user-circle text-3xl"></i>
            </button>
        </div>
        <div class="flex flex-1 p-4">
            <div class="w-full max-w-xl mx-auto flex flex-col">
                <div id="chat-messages" class="flex-1 overflow-y-auto mb-4">
                    </div>
                <div class="flex items-center p-2">
                    <input
                        id="user-input"
                        type="text"
                        placeholder="Ask me anything"
                        class="flex-1 bg-[#283339] rounded-l-xl px-4 py-3 focus:outline-none"
                    />
                    <button
                        id="send-button"
                        class="bg-[#2badee] text-[#111618] px-4 py-3 rounded-r-xl"
                    >
                        Send
                    </button>
                </div>
            </div>
        </div>
    </div>
    <aside id="sidebar" class="w-64 bg-[#1a202c] p-4 flex flex-col fixed top-0 left-0 h-full">
        <div class="flex items-center justify-end mb-6">
            <button id="close-sidebar" class="bg-transparent border-none p-0">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <button id="new-chat-button" class="bg-transparent text-left px-0 py-2 mb-4 hover:bg-[#283339] rounded-md">
            <i class="fas fa-plus mr-2"></i>
            <span class="font-medium">New chat</span>
        </button>
        <div id="previous-chats" class="mb-4">
            <h2 class="text-sm text-gray-400 mb-2">Previous Chats</h2>
            </div>
        <div class="mt-auto">
            <a href="/settings" class="block p-2 hover:bg-[#283339] rounded-md">
                <i class="fas fa-cog mr-2"></i>
                <span class="text-sm">Settings</span>
            </a>
        </div>
    </aside>
    <script>
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const newChatButton = document.getElementById('new-chat-button');
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const closeSidebar = document.getElementById('close-sidebar');
        const previousChats = document.getElementById('previous-chats');

        let conversations = []; // Store conversation history
        // Function to toggle sidebar visibility
        function toggleSidebar() {
            sidebar.classList.toggle('open');
        }

        sidebarToggle.addEventListener('click', toggleSidebar);
        closeSidebar.addEventListener('click', toggleSidebar);

        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        newChatButton.addEventListener('click', startNewChat);

        function startNewChat() {
            chatMessages.innerHTML = '';
            addBotMessage('Welcome! How can I assist you today?');
            conversations.push(); // Start a new conversation
            updatePreviousChats();
        }

        function sendMessage() {
            const message = userInput.value.trim();
            if (message) {
                addUserMessage(message);
                userInput.value = '';
                getApiResponse(message);
            }
        }

        function addUserMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-bubble', 'user');
            messageDiv.innerHTML = `<i class="fas fa-user mr-2"></i><span>${message}</span>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Add user message to the current conversation
            if (conversations.length > 0) {
                conversations[conversations.length - 1].push({ role: 'user', content: message });
            }
        }

        function addBotMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-bubble', 'bot');
            messageDiv.innerHTML = `<i class="fas fa-robot mr-2"></i><span>${message}</span>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Add bot message to the current conversation
            if (conversations.length > 0) {
                conversations[conversations.length - 1].push({ role: 'bot', content: message });
            }
            updatePreviousChats();
        }

        function getApiResponse(message) {
            const apiUrl = 'https://ai-api-guya.onrender.com/api/chat/';

            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ user_input: message }),
            })
            .then(response => response.json())
            .then(data => {
                console.log("API Response Data:", data); // Log the API response
                addBotMessage(data.response);
            })
            .catch(error => {
                console.error('Error:', error);
                addBotMessage('Sorry, I encountered an error.');
            });
        }

        function updatePreviousChats() {
            previousChats.innerHTML = '<h2 class="text-sm text-gray-400 mb-2">Previous Chats</h2>'; // Clear previous list

            conversations.forEach((conversation, index) => {
                // Get a short summary of the conversation
                let summary = conversation.length > 0 ? conversation[0].content.substring(0, 30) + '...' : 'New Chat';
                const chatDiv = document.createElement('div');
                chatDiv.classList.add('p-2', 'hover:bg-[#283339]', 'rounded-md', 'mb-1', 'cursor-pointer');
                chatDiv.innerHTML = `<i class="fas fa-equals mr-2"></i><span class="text-sm">Chat ${index + 1}: ${summary}</span>`;
                chatDiv.addEventListener('click', () => {
                    loadConversation(index);
                });
                previousChats.appendChild(chatDiv);
            });
        }
        function loadConversation(index) {
    chatMessages.innerHTML = ''; // Clear current chat

    const conversation = conversations[index];
    if (conversation) {
        conversation.forEach(message => {
            if (message.role === 'user') {
                addUserMessage(message.content);
            } else if (message.role === 'bot') {
                addBotMessage(message.content);
            }
        });
    }
}
        // Initial welcome message and conversation
        startNewChat();
        updatePreviousChats();

        // Location functionality (optional)
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                console.log('Geolocation is not supported by this browser.');
            }
        }

        function showPosition(position) {
            console.log(
                'Latitude: ' +
                    position.coords.latitude +
                    '<br>Longitude: ' +
                    position.coords.longitude
            );
            // You can use the coordinates to display location information
        }

        function showError(error) {
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    console.log('User denied the request for geolocation.');
                    break;
                case error.POSITION_UNAVAILABLE:
                    console.log('Location information is unavailable.');
                    break;
                case error.TIMEOUT:
                    console.log('The request to get user location timed out.');
                    break;
                case error.UNKNOWN_ERROR:
                    console.log('An unknown error occurred.');
                    break;
            }
        }

        // getLocation(); // Call this to attempt to get the user's location
    </script>
</body>
</html>